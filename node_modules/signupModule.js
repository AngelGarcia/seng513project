/*
 * Nodule for new user signup 
 */ 

var sqlite = require('sqlite');


// ??? 
var SignupModule = exports.SignupModule = function() { 
	this.signup = 'signup';  
};

/*
 * Create a new user in the database
 */
SignupModule.handleSignup = function(request, res) 
{
	console.log("New user signup submitted.");
	
	var success = false;
	var signupBody = '';	
	var db = new sqlite.Database();
	db.open("CivicConnect.db", function (error) {});

	request.on('data', function(chunk){
		signupBody += chunk.toString();
	});
	
	request.on('end', function(){
		var signupInfo = qs.parse(signupBody);
		var username = signupInfo['username'];
		var email = signupInfo['email'];
		var password = signupInfo['password'];

		var sqlInsertNewUser = "INSERT INTO users VALUES (null,'" + username + "', '" + email + "', '" + password + "');";
		db.execute(sqlInsertNewUser, function(error, rows){
			if(error) {
				console.log('error occured saving to DB:' + error.toString());
				success = false;
			}
			else {
				console.log('database save successful!');
				success = true;
			}
		});
		
		db.close(function(error){});					
	});
	
	if (success){
		res.writeHead(200, { 'Content-Type' : 'text/html' }); 
		res.end('<html><body><h1>Signup Successful</h1></body></html>');
	}
	else{
		res.writeHead(200, { 'Content-Type' : 'text/html' }); 
		res.end('<html><body><h1>Signup Failed</h1></body></html>');
	}	
}



