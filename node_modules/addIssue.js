/*
 *	addIssue.js
 */
var AddIssue = exports.AddIssue = function() {
};

var querystring = require('querystring'),
    util = require('util');
    dbAccess = require('./dbAccess'),
	url = require('url'); 

/* 
 * Handle POST form	
 */
AddIssue.add = function(req, res) {
    if (req.method == 'POST') {
		// from the form data given, parse them according to their respective form objects
        req.addListener('data', function(chunk) {
            var POST = querystring.parse(chunk);
			
				// insert issue from the form 
                dbAccess.create('issues', { values: ['user_id="332338"',
                                            'status="online"',
                                            'title="' + POST.title+'"',
                                            'description="'+ POST.description +'"',
                                            'link="' + POST.link+'"',
                                            'location="' + POST.location+'"',
											'tags="' + POST.tags+'"']},
					// if an error occurred when inserting a new issue, print out the error
					function(error) {
						if (error)
						{
							console.log("Error inserting into database!"); 
							console.log(error); 
						}
						else
							console.log("Successfully added a new issue!");
                });


        }).addListener('end', function() {

            res.writeHead(200);
            res.end('<html><body><h1>Issue Added Successfully</h1></body></html>');
        });

    }
}

