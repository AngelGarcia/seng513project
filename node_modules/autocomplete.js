/* 
 * autocomplete.js  
 */ 
var dbAccess = require('dbAccess'); 
var	url = require('url');

var Autocomplete = exports.Autocomplete = function() {};

/**
* Main entry point for the module
*/
Autocomplete.getList = function(request, response)
{
    var parsedURL = url.parse(request.url, true);
    var term = parsedURL.query.term;
    console.log(parsedURL.query);
    var table = parsedURL.query.table;
    var column = parsedURL.query.column;
    var SQLquery = "SELECT " + column + " FROM " + table +
        " WHERE " + column + " LIKE '" + term + "%'";
    console.log(SQLquery);
    dbAccess.runQuery(SQLquery, sendList(response));
}

function sendList(response)
{
    return function(error, rows)
    {
        if (error) {throw error;}
        
        var list = [];
        for(var i in rows)
        {
            list[i] = rows[i].name;
        }
        response.end(JSON.stringify(list));
    };
}
