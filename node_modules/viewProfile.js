var dbAccess = require('dbAccess');
var url = require('url');

var ViewProfile = exports.ViewProfile = function() {};

/**
 * Display a profile page
 * @param request Request object from the client
 * @param response Response object to send the data
 */
ViewProfile.display = function(request, response)
{
	var parsedURL = url.parse(request.url, true);
	var id = parsedURL.query["id"];
	dbAccess.find('users', { conditions:['id="' + id + '"'] }, function(error, results) 
	{
		// Header
		response.write('<head>');
		response.write('<meta http-equiv="Content-Type" content="text/html" charset="utf-8"/>');
		response.write('<link rel="stylesheet" href="css/style.css" type="text/css" />');
		response.write('<title>CivicConnect</title>');
		response.write('</head>');
		response.write('<body>');
		response.write('<div id="page">');
		response.write('<div id="header"><a href="#">join</a> | <a href="#">login</a></div>');
		response.write('<div id="menu">');
		response.write('<ul>');
		response.write('<li><a href="index.html">Home</a></li>');
		response.write('<li><a href="about.html">About</a></li>');
		response.write('</ul>');
		response.write('</div>');
		response.write('<div id="quick-task-bar">');
		response.write('<a href="#" id="add-issue-button">Add Issue</a>');
		response.write('<form id="search-form">');
		response.write('<input type="text" id="search-box" name="search" value="" />');
		response.write('<input type="submit" id="search-button" value="Search" />');
		response.write('</form>');
		response.write('</div>');
		response.write('<div id="content">');
		
		// Content
		if(results.length != 1) // Found no of many profiles
		{
			response.write('<h1>Not Found</h1>');
		}
		else
		{
			response.write('<h1>' + results[0].name + '</h1>');
			response.write('<p><h2>');
			response.write('<strong>Neighborhood</strong> ');
			if(results[0].neighborhood) {response.write(results[0].neighborhood);}
			response.write('<br>');
			response.write('<strong>Postal Code</strong> ');
			if(results[0].postal_code) {response.write(results[0].postal_code);}
			response.write('<br>');
			response.write('<strong>Reputation</strong> ' + results[0].reputation_score); 
			response.write('</h2>');
		}
		
		// Footer
		response.write('</div> <div id="footer"><p>&copy; 2011 University of Calgary. All rights reserved.</p></div></div></body> </html>');
		response.end();
	});
}
