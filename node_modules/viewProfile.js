var dbAccess = require('dbAccess');
var url = require('url');

var ViewProfile = exports.ViewProfile = function() {};

/**
 * Display a profile page
 * @param request Request object from the client
 * @param response Response object to send the data
 */
ViewProfile.display = function(request, response)
{
	var parsedURL = url.parse(request.url, true);
	var id = parsedURL.query.id;
	dbAccess.find('users', { conditions:['id="' + id + '"'] }, function(error, users)
	{
		if(error)
			throw error;
		
		if(users.length != 1)
		{
			//TODO: error messages need cleaning.
			response.write('<h1>Not Found</h1>');
			response.end();
		}
		else
		{
			user = users[0];
			variables = {
				name: user.name,
				neighborhood: user.neighborhood || '',
				postal_code: user.postal_code || '',
				facebook_account: user.facebook_account || 'None',
				twitter_account: user.twitter_account || 'None'
			}
			
			response.render('views/viewProfile.html', variables);
		}
	});
}
