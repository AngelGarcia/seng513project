/* fsUtil.js
 * Provides helper functions for handling files 
 */ 
var fs = require('fs'); 

/* readFiles 
 * Reads multiple files in parallel and returns the files contents once all of them have been read 
 * Returns an array of the files which can be accessed using their file names 
 * 
 * 'files' An array of file paths to read
 * 'callback' The callback is passed two arguments (err, results), where results is an array of file contents
 */
exports.readFiles = function(files, callback) {
	if (files.length == 0) { 
		callback(null, {}); 
	}
	
	var readCount = 0;
	var results = {}; 
  
	function handleReadFile(file, callback) {
		fs.readFile(file, function(err, data) {
			callback(err, file, data);
		}); 
	}
	
	for (var i = 0; i < files.length; i++) {
		var filename = files[i];
		handleReadFile(filename, function(err, fname, data) {
			if (err) {
				callback(err, fname, data);
				return;
			}
			
			results[fname] = data; 
			
			if (++readCount == files.length) { // Done reading all files 
				callback(err, results);
			}
		});
	}
}
